<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>RECYBOOM - Reciclaje Simple</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

  <!-- Leaflet CSS -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""
  />

  <style>
    :root {
      --green: #22c55e;
      --green-dark: #15803d;
      --blue: #0ea5e9;
      --red: #ef4444;

      --bg: #f3f4f6;
      --bg-card: #ffffff;
      --border: #e5e7eb;

      --text-main: #111827;
      --text-muted: #6b7280;

      --radius-lg: 16px;
      --radius-pill: 999px;
    }

    * {
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: var(--bg);
      color: var(--text-main);
    }

    /* CONTENEDOR APP */
    .app {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      background: var(--bg);
    }

    /* HEADER */
    .header {
      background: #ffffff;
      border-bottom: 1px solid var(--border);
      padding: 10px 16px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .logo-circle {
      width: 36px;
      height: 36px;
      border-radius: 999px;
      background: #dcfce7;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--green-dark);
      font-weight: 700;
      font-size: 18px;
    }

    .header-title {
      margin: 0;
      font-size: 18px;
      font-weight: 700;
    }

    .header-sub {
      margin: 0;
      font-size: 12px;
      color: var(--text-muted);
    }

    .header-badge {
      font-size: 11px;
      padding: 4px 10px;
      border-radius: var(--radius-pill);
      border: 1px solid var(--border);
      background: #f9fafb;
      color: var(--text-muted);
    }

    /* MAIN */
    .main {
      flex: 1;
      display: flex;
      justify-content: center;
      padding: 10px 12px 70px; /* espacio para el men√∫ abajo */
    }

    .content {
      width: 100%;
      max-width: 480px;
    }

    /* VISTAS (P√ÅGINAS) */
    .view {
      display: none;
    }

    .view-active {
      display: block;
    }

    /* CARDS */
    .card {
      background: var(--bg-card);
      border-radius: var(--radius-lg);
      border: 1px solid var(--border);
      padding: 12px 12px 10px;
      margin-bottom: 12px;
    }

    .card-title {
      font-size: 16px;
      font-weight: 600;
      margin: 0 0 4px;
    }

    .card-text {
      margin: 0 0 8px;
      font-size: 13px;
      color: var(--text-muted);
    }

    /* BOTONES */
    .btn-main {
      width: 100%;
      border-radius: var(--radius-pill);
      border: none;
      padding: 10px 14px;
      background: var(--green);
      color: white;
      font-size: 15px;
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      cursor: pointer;
      margin-bottom: 8px;
    }

    .btn-main:active {
      transform: translateY(1px);
      background: var(--green-dark);
    }

    .btn-small {
      border-radius: var(--radius-pill);
      border: none;
      padding: 8px 12px;
      background: var(--green);
      color: white;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      margin-top: 4px;
    }

    .btn-small:active {
      background: var(--green-dark);
    }

    .btn-simple {
      width: 100%;
      border-radius: var(--radius-pill);
      border: 1px solid var(--border);
      padding: 8px 12px;
      background: #f9fafb;
      font-size: 13px;
      cursor: pointer;
      margin-bottom: 8px;
    }

    /* MAPA */
    #map {
      width: 100%;
      height: 55vh;
      min-height: 260px;
      border-radius: 14px;
      border: 1px solid var(--border);
      overflow: hidden;
      margin-bottom: 6px;
    }

    .map-info {
      font-size: 12px;
      color: var(--text-muted);
      margin-bottom: 4px;
    }

    .status {
      font-size: 12px;
      padding: 6px 10px;
      border-radius: var(--radius-pill);
      background: #f9fafb;
      border: 1px solid var(--border);
      display: inline-flex;
      align-items: center;
      gap: 6px;
      margin-bottom: 6px;
    }

    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: var(--green);
    }

    .status-dot.error {
      background: var(--red);
    }

    /* FORMULARIOS */
    .form-group {
      margin-bottom: 10px;
      font-size: 13px;
    }

    .form-label {
      display: block;
      margin-bottom: 3px;
      color: var(--text-muted);
    }

    input[type="text"],
    input[type="datetime-local"],
    select,
    textarea {
      width: 100%;
      padding: 8px 10px;
      border-radius: 10px;
      border: 1px solid var(--border);
      background: #f9fafb;
      font-size: 13px;
      outline: none;
    }

    input::placeholder,
    textarea::placeholder {
      color: #9ca3af;
    }

    input:focus,
    select:focus,
    textarea:focus {
      border-color: var(--green);
      background: #ffffff;
    }

    textarea {
      resize: vertical;
      min-height: 60px;
    }

    .message {
      font-size: 12px;
      margin-top: 4px;
    }

    .message-ok {
      color: var(--green-dark);
    }

    .message-error {
      color: var(--red);
    }

    .list {
      margin: 6px 0 0;
      padding-left: 18px;
      font-size: 12px;
      color: var(--text-muted);
      max-height: 100px;
      overflow-y: auto;
    }

    /* PERFIL */
    .profile-row {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 10px;
    }

    .profile-avatar {
      width: 48px;
      height: 48px;
      border-radius: 999px;
      background: #dcfce7;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 22px;
      color: var(--green-dark);
    }

    .profile-name {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 2px;
    }

    .profile-text {
      font-size: 13px;
      color: var(--text-muted);
    }

    /* MEN√ö INFERIOR */
    .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: #ffffff;
      border-top: 1px solid var(--border);
    }

    .bottom-nav-inner {
      max-width: 480px;
      margin: 0 auto;
      display: flex;
      justify-content: space-around;
      padding: 6px 10px;
    }

    .nav-btn {
      flex: 1;
      border: none;
      background: transparent;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 2px;
      padding: 4px;
      border-radius: 999px;
      font-size: 12px;
      color: var(--text-muted);
      cursor: pointer;
    }

    .nav-icon {
      font-size: 20px;
    }

    .nav-btn-active {
      color: var(--green-dark);
      font-weight: 600;
      background: #dcfce7;
    }
  </style>
</head>
<body>
  <div class="app">
    <!-- ENCABEZADO -->
    <header class="header">
      <div class="header-left">
        <div class="logo-circle">RB</div>
        <div>
          <h1 class="header-title">RECYBOOM</h1>
          <p class="header-sub">Reciclar f√°cil para todos</p>
        </div>
      </div>
      <div class="header-badge">Piloto ¬∑ Santiago</div>
    </header>

    <!-- CONTENIDO -->
    <main class="main">
      <div class="content">
        <!-- VISTA MAPA -->
        <section id="view-map" class="view view-active">
          <div class="card">
            <h2 class="card-title">Mapa de reciclaje</h2>
            <p class="card-text">
              Mira tu ubicaci√≥n y algunos puntos de reciclaje de ejemplo. Tambi√©n puedes proponer un nuevo punto.
            </p>

            <button class="btn-main" id="btn-locate-top">
              üìç Ver mi ubicaci√≥n
            </button>

            <div id="map"></div>

            <div class="status" id="location-status">
              <div id="location-dot" class="status-dot"></div>
              <span>Ubicaci√≥n lista para detectar.</span>
            </div>

            <p class="map-info">
              Toca en el mapa para sugerir un nuevo lugar donde reciclar.
            </p>

            <p id="coordinates-label" class="map-info">
              A√∫n no has tocado el mapa.
            </p>

            <div class="form-group">
              <label class="form-label" for="stop-name">Nombre del lugar</label>
              <input
                type="text"
                id="stop-name"
                placeholder="Ej: Punto limpio Junta de Vecinos"
              />
            </div>

            <div class="form-group">
              <label class="form-label" for="stop-type">Tipo de lugar</label>
              <select id="stop-type">
                <option value="">Selecciona una opci√≥n</option>
                <option value="p√∫blico">P√∫blico (municipal)</option>
                <option value="vecinal">Vecinal</option>
                <option value="comercio">Comercio</option>
                <option value="colegio">Colegio / universidad</option>
              </select>
            </div>

            <div class="form-group">
              <label class="form-label" for="stop-materials">¬øQu√© se puede reciclar?</label>
              <textarea
                id="stop-materials"
                placeholder="Ej: Pl√°stico, vidrio, papel..."
              ></textarea>
            </div>

            <button class="btn-small" id="btn-new-stop">
              üìç Guardar sugerencia (demo)
            </button>
            <div id="new-stop-message" class="message"></div>

            <h3 style="font-size:14px; margin:10px 0 4px;">Lugares de ejemplo</h3>
            <ul id="example-list" class="list"></ul>

            <h3 style="font-size:14px; margin:10px 0 4px;">Tus sugerencias (solo hoy)</h3>
            <ul id="suggested-list" class="list"></ul>
          </div>
        </section>

        <!-- VISTA RETIRO -->
        <section id="view-retire" class="view">
          <div class="card">
            <h2 class="card-title">Pedir retiro (demo)</h2>
            <p class="card-text">
              Aqu√≠ puedes simular que pides un retiro de reciclaje. No se env√≠a a ning√∫n lado, es solo para mostrar la idea.
            </p>

            <div class="form-group">
              <label class="form-label" for="pickup-address">Direcci√≥n</label>
              <input
                type="text"
                id="pickup-address"
                placeholder="Ej: Calle 123, comuna"
              />
            </div>

            <div class="form-group">
              <label class="form-label" for="pickup-date">D√≠a y hora</label>
              <input type="datetime-local" id="pickup-date" />
            </div>

            <div class="form-group">
              <label class="form-label" for="pickup-type">Qu√© quieres reciclar</label>
              <select id="pickup-type">
                <option value="">Selecciona una opci√≥n</option>
                <option value="mixto">Mezcla de envases</option>
                <option value="plastico">Pl√°sticos</option>
                <option value="vidrio">Vidrio</option>
                <option value="papel">Papel / cart√≥n</option>
                <option value="electro">Electr√≥nicos</option>
                <option value="pilas">Pilas</option>
              </select>
            </div>

            <div class="form-group">
              <label class="form-label" for="pickup-notes">Comentario (opcional)</label>
              <input
                type="text"
                id="pickup-notes"
                placeholder="Ej: Casa blanca, port√≥n caf√©..."
              />
            </div>

            <button class="btn-small" id="btn-pickup">
              ‚úÖ Confirmar retiro (demo)
            </button>
            <div id="pickup-message" class="message"></div>
          </div>
        </section>

        <!-- VISTA PERFIL -->
        <section id="view-profile" class="view">
          <div class="card">
            <h2 class="card-title">Mi perfil</h2>
            <div class="profile-row">
              <div class="profile-avatar">üôÇ</div>
              <div>
                <div class="profile-name">Invitado RECYBOOM</div>
                <div class="profile-text">Cuenta de prueba</div>
              </div>
            </div>
            <p class="card-text">
              Aqu√≠ podr√≠as ver en el futuro:
            </p>
            <ul class="list">
              <li>Cu√°ntas veces has reciclado.</li>
              <li>Qu√© materiales reciclas m√°s.</li>
              <li>Tu impacto ambiental estimado.</li>
            </ul>
          </div>

          <div class="card">
            <h2 class="card-title">Sobre la app</h2>
            <p class="card-text">
              RECYBOOM quiere hacer el reciclaje algo simple:
            </p>
            <ul class="list">
              <li>Ver lugares cercanos para reciclar.</li>
              <li>Proponer nuevos puntos de reciclaje.</li>
              <li>Simular retiros a domicilio.</li>
            </ul>
          </div>
        </section>
      </div>
    </main>

    <!-- MEN√ö ABAJO -->
    <nav class="bottom-nav">
      <div class="bottom-nav-inner">
        <button class="nav-btn nav-btn-active" data-view="map">
          <span class="nav-icon">üó∫Ô∏è</span>
          <span>Mapa</span>
        </button>
        <button class="nav-btn" data-view="retire">
          <span class="nav-icon">üöö</span>
          <span>Retiro</span>
        </button>
        <button class="nav-btn" data-view="profile">
          <span class="nav-icon">üë§</span>
          <span>Perfil</span>
        </button>
      </div>
    </nav>
  </div>

  <!-- Leaflet JS -->
  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin=""
  ></script>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      /* --------- NAVEGACI√ìN SIMPLE --------- */
      const views = {
        map: document.getElementById("view-map"),
        retire: document.getElementById("view-retire"),
        profile: document.getElementById("view-profile"),
      };
      const navButtons = document.querySelectorAll(".nav-btn");

      function showView(name) {
        Object.values(views).forEach((v) => v.classList.remove("view-active"));
        views[name].classList.add("view-active");

        navButtons.forEach((btn) => {
          if (btn.dataset.view === name) {
            btn.classList.add("nav-btn-active");
          } else {
            btn.classList.remove("nav-btn-active");
          }
        });

        if (name === "map" && map) {
          setTimeout(() => map.invalidateSize(), 200);
        }
      }

      navButtons.forEach((btn) => {
        btn.addEventListener("click", () => {
          showView(btn.dataset.view);
        });
      });

      /* --------- MAPA B√ÅSICO --------- */
      const locationStatus = document.getElementById("location-status");
      const locationDot = document.getElementById("location-dot");
      const coordinatesLabel = document.getElementById("coordinates-label");
      const exampleList = document.getElementById("example-list");
      const suggestedList = document.getElementById("suggested-list");

      const btnLocateTop = document.getElementById("btn-locate-top");
      const btnNewStop = document.getElementById("btn-new-stop");
      const newStopMessage = document.getElementById("new-stop-message");

      let map;
      let userMarker = null;
      let newStopMarker = null;
      let newStopLatLng = null;

      // Lugares de ejemplo
      const examplePlaces = [
        {
          name: "Punto Limpio Plaza √ëu√±oa",
          info: "Pl√°stico, vidrio, papel",
          lat: -33.455,
          lng: -70.598,
        },
        {
          name: "EcoDep√≥sito La Florida",
          info: "Envases mixtos",
          lat: -33.482,
          lng: -70.651,
        },
        {
          name: "Reciclaje Centro",
          info: "Pilas y electr√≥nicos",
          lat: -33.445,
          lng: -70.65,
        },
      ];

      // Inicializar mapa
      map = L.map("map", {
        center: [-33.45, -70.66],
        zoom: 12,
      });

      L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
        maxZoom: 19,
        attribution: "&copy; OpenStreetMap contributors",
      }).addTo(map);

      // Mostrar lugares de ejemplo
      examplePlaces.forEach((p) => {
        L.circleMarker([p.lat, p.lng], {
          radius: 7,
          color: "#22c55e",
          fillColor: "#22c55e",
          fillOpacity: 0.9,
        })
          .addTo(map)
          .bindPopup("<strong>" + p.name + "</strong><br><small>" + p.info + "</small>");

        const li = document.createElement("li");
        li.textContent = p.name + " ‚Äì " + p.info;
        exampleList.appendChild(li);
      });

      function updateLocationStatus(message, error) {
        locationStatus.querySelector("span").textContent = message;
        if (error) {
          locationDot.classList.add("error");
        } else {
          locationDot.classList.remove("error");
        }
      }

      function locateUser() {
        if (!navigator.geolocation) {
          updateLocationStatus("Tu dispositivo no tiene geolocalizaci√≥n.", true);
          return;
        }

        updateLocationStatus("Buscando tu ubicaci√≥n...", false);

        navigator.geolocation.getCurrentPosition(
          (pos) => {
            const lat = pos.coords.latitude;
            const lng = pos.coords.longitude;

            if (userMarker) map.removeLayer(userMarker);

            userMarker = L.circleMarker([lat, lng], {
              radius: 8,
              color: "#0ea5e9",
              fillColor: "#0ea5e9",
              fillOpacity: 0.9,
            })
              .addTo(map)
              .bindPopup("Est√°s aqu√≠");

            map.setView([lat, lng], 14);
            updateLocationStatus("Ubicaci√≥n detectada.", false);
          },
          () => {
            updateLocationStatus("No se pudo obtener la ubicaci√≥n.", true);
          }
        );
      }

      btnLocateTop.addEventListener("click", () => {
        showView("map");
        locateUser();
      });

      // Tocar mapa para nuevo punto
      map.on("click", (e) => {
        newStopLatLng = e.latlng;

        if (newStopMarker) map.removeLayer(newStopMarker);

        newStopMarker = L.circleMarker(newStopLatLng, {
          radius: 7,
          color: "#eab308",
          fillColor: "#eab308",
          fillOpacity: 0.9,
        })
          .addTo(map)
          .bindPopup("Nuevo punto sugerido aqu√≠")
          .openPopup();

        coordinatesLabel.textContent =
          "Punto elegido: " +
          newStopLatLng.lat.toFixed(5) +
          ", " +
          newStopLatLng.lng.toFixed(5);
      });

      // Guardar sugerencia (solo en la lista)
      btnNewStop.addEventListener("click", () => {
        const name = document.getElementById("stop-name").value.trim();
        const type = document.getElementById("stop-type").value;
        const materials = document.getElementById("stop-materials").value.trim();

        if (!newStopLatLng) {
          newStopMessage.textContent = "Primero toca el mapa para elegir un lugar.";
          newStopMessage.className = "message message-error";
          return;
        }

        if (!name || !type) {
          newStopMessage.textContent = "Escribe el nombre del lugar y el tipo.";
          newStopMessage.className = "message message-error";
          return;
        }

        const li = document.createElement("li");
        li.textContent =
          name +
          " (" +
          type +
          ") ‚Äì " +
          newStopLatLng.lat.toFixed(4) +
          ", " +
          newStopLatLng.lng.toFixed(4);
        if (materials) {
          li.textContent += " ¬∑ " + materials;
        }
        suggestedList.appendChild(li);

        newStopMessage.textContent = "Sugerencia guardada (solo en esta demo).";
        newStopMessage.className = "message message-ok";

        document.getElementById("stop-name").value = "";
        document.getElementById("stop-type").value = "";
        document.getElementById("stop-materials").value = "";
      });

      /* --------- RETIRO DEMO --------- */
      const btnPickup = document.getElementById("btn-pickup");
      const pickupMessage = document.getElementById("pickup-message");

      btnPickup.addEventListener("click", () => {
        const address = document.getElementById("pickup-address").value.trim();
        const date = document.getElementById("pickup-date").value;
        const type = document.getElementById("pickup-type").value;

        if (!address || !date || !type) {
          pickupMessage.textContent =
            "Por favor completa direcci√≥n, d√≠a/hora y tipo de reciclaje.";
          pickupMessage.className = "message message-error";
          return;
        }

        pickupMessage.textContent =
          "Retiro guardado (demo). En una app real, esta solicitud se enviar√≠a al sistema de reciclaje.";
        pickupMessage.className = "message message-ok";
      });
    });
  </script>
</body>
</html>
