<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>RECYBOOM - Reciclaje Simple</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

  <!-- Leaflet CSS -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""
  />

  <style>
    :root {
      --green: #22c55e;
      --green-dark: #15803d;
      --teal: #00897b;
      --blue: #0ea5e9;
      --red: #ef4444;

      --bg: #ecfdf5;
      --bg-card: #ffffff;
      --border: #e5e7eb;

      --text-main: #0f172a;
      --text-muted: #6b7280;

      --radius-lg: 18px;
      --radius-pill: 999px;
    }

    * {
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #bbf7d0 0, #ecfdf5 35%, #f9fafb 100%);
      color: var(--text-main);
    }

    /* SPLASH / PANTALLA INICIO */
    .splash {
      position: fixed;
      inset: 0;
      background: linear-gradient(145deg, #16a34a, #22c55e);
      color: #ecfdf5;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      padding: 24px;
      z-index: 50;
      transition: opacity 0.25s ease-out;
    }

    .splash-title {
      font-size: 28px;
      font-weight: 800;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      margin-bottom: 8px;
    }

    .splash-sub {
      font-size: 14px;
      opacity: 0.9;
      margin-bottom: 24px;
    }

    .splash-icon {
      font-size: 60px;
      margin-bottom: 16px;
    }

    .splash-hint {
      font-size: 13px;
      opacity: 0.9;
      padding: 6px 14px;
      border-radius: 999px;
      background: rgba(22, 101, 52, 0.35);
      border: 1px solid rgba(187, 247, 208, 0.4);
    }

    /* CONTENEDOR APP */
    .app {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      background: transparent;
    }

    /* HEADER */
    .header {
      background: var(--teal);
      color: #ecfdf5;
      border-bottom: 1px solid rgba(15, 118, 110, 0.6);
      padding: 10px 16px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: sticky;
      top: 0;
      z-index: 10;
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .logo-circle {
      width: 36px;
      height: 36px;
      border-radius: 999px;
      background: #bbf7d0;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--green-dark);
      font-weight: 700;
      font-size: 18px;
      box-shadow: 0 6px 18px rgba(0, 105, 92, 0.4);
    }

    .header-title {
      margin: 0;
      font-size: 18px;
      font-weight: 700;
    }

    .header-sub {
      margin: 0;
      font-size: 12px;
      color: #e0f2f1;
    }

    .header-badge {
      font-size: 11px;
      padding: 4px 10px;
      border-radius: var(--radius-pill);
      border: 1px solid rgba(224, 242, 241, 0.8);
      background: rgba(38, 166, 154, 0.35);
      color: #e0f2f1;
    }

    /* MAIN */
    .main {
      flex: 1;
      display: flex;
      justify-content: center;
      padding: 12px 12px 80px; /* espacio para men√∫ abajo */
    }

    .content {
      width: 100%;
      max-width: 480px;
    }

    /* VISTAS (P√ÅGINAS) */
    .view {
      display: none;
    }

    .view-active {
      display: block;
    }

    /* HOME / PANTALLA CON MAPA CIRCULAR */
    .home-view {
      padding-top: 4px;
    }

    .home-hero {
      background: #ffffff;
      border-radius: 0 0 24px 24px;
      padding: 18px 18px 24px;
      text-align: center;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
      box-shadow: 0 12px 30px rgba(15, 23, 42, 0.1);
      border: 1px solid var(--border);
      border-top: none;
    }

    .home-title {
      font-size: 20px;
      font-weight: 800;
      letter-spacing: 0.16em;
      text-transform: uppercase;
      color: var(--teal);
    }

    .home-subtitle {
      font-size: 13px;
      color: var(--text-muted);
    }

    .home-logo {
      width: 56px;
      height: 56px;
      border-radius: 999px;
      background: #e0f2f1;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 32px;
      box-shadow: 0 10px 30px rgba(0, 105, 92, 0.35);
    }

    .home-map-circle {
      width: 210px;
      height: 210px;
      max-width: 68vw;
      max-height: 68vw;
      border-radius: 999px;
      overflow: hidden;
      border: 4px solid #ffffff;
      box-shadow: 0 14px 40px rgba(15, 23, 42, 0.25);
      margin-top: 6px;
      cursor: pointer;
      position: relative;
    }

    .home-map-circle::after {
      content: "Haz BOOM para reciclar";
      position: absolute;
      inset: auto 12px 10px 12px;
      text-align: center;
      font-size: 11px;
      font-weight: 600;
      letter-spacing: 0.05em;
      text-transform: uppercase;
      padding: 4px 6px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.7);
      color: #f9fafb;
    }

    .home-cta {
      margin-top: 12px;
      font-weight: 700;
      font-size: 15px;
      color: var(--teal);
    }

    .home-hint {
      font-size: 12px;
      color: var(--text-muted);
    }

    .home-quick-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 10px;
      margin-top: 16px;
    }

    .home-quick-card {
      background: #f9fafb;
      border-radius: 14px;
      padding: 10px 8px;
      border: 1px solid #e5e7eb;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
      font-size: 12px;
      cursor: pointer;
    }

    .home-quick-icon {
      font-size: 20px;
    }

    .home-quick-title {
      font-weight: 600;
    }

    /* CARDS */
    .card {
      background: rgba(255, 255, 255, 0.98);
      border-radius: var(--radius-lg);
      border: 1px solid rgba(226, 232, 240, 0.9);
      padding: 12px 12px 10px;
      margin-bottom: 12px;
      box-shadow: 0 10px 24px rgba(15, 23, 42, 0.06);
    }

    .card-title {
      font-size: 16px;
      font-weight: 600;
      margin: 0 0 4px;
    }

    .card-text {
      margin: 0 0 8px;
      font-size: 13px;
      color: var(--text-muted);
    }

    /* BOTONES */
    .btn-main {
      width: 100%;
      border-radius: var(--radius-pill);
      border: none;
      padding: 10px 14px;
      background: linear-gradient(135deg, #22c55e, #16a34a);
      color: white;
      font-size: 15px;
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      cursor: pointer;
      margin-bottom: 8px;
      box-shadow: 0 10px 24px rgba(22, 163, 74, 0.4);
    }

    .btn-main:active {
      transform: translateY(1px);
      box-shadow: 0 6px 18px rgba(22, 163, 74, 0.5);
      background: linear-gradient(135deg, #15803d, #16a34a);
    }

    .btn-small {
      border-radius: var(--radius-pill);
      border: none;
      padding: 8px 12px;
      background: linear-gradient(135deg, #22c55e, #16a34a);
      color: white;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      margin-top: 4px;
      box-shadow: 0 7px 18px rgba(22, 163, 74, 0.4);
    }

    .btn-small:active {
      background: linear-gradient(135deg, #15803d, #16a34a);
    }

    .btn-simple {
      width: 100%;
      border-radius: var(--radius-pill);
      border: 1px solid var(--border);
      padding: 8px 12px;
      background: #f9fafb;
      font-size: 13px;
      cursor: pointer;
      margin-bottom: 8px;
    }

    /* MAPA PRINCIPAL */
    #map {
      width: 100%;
      height: 55vh;
      min-height: 260px;
      border-radius: 14px;
      border: 1px solid var(--border);
      overflow: hidden;
      margin-bottom: 6px;
    }

    .map-info {
      font-size: 12px;
      color: var(--text-muted);
      margin-bottom: 4px;
    }

    .status {
      font-size: 12px;
      padding: 6px 10px;
      border-radius: var(--radius-pill);
      background: #f9fafb;
      border: 1px solid var(--border);
      display: inline-flex;
      align-items: center;
      gap: 6px;
      margin-bottom: 6px;
    }

    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: var(--green);
    }

    .status-dot.error {
      background: var(--red);
    }

    /* FORMULARIOS */
    .form-group {
      margin-bottom: 10px;
      font-size: 13px;
    }

    .form-label {
      display: block;
      margin-bottom: 3px;
      color: var(--text-muted);
    }

    input[type="text"],
    input[type="datetime-local"],
    select,
    textarea {
      width: 100%;
      padding: 8px 10px;
      border-radius: 10px;
      border: 1px solid var(--border);
      background: #f9fafb;
      font-size: 13px;
      outline: none;
    }

    input::placeholder,
    textarea::placeholder {
      color: #9ca3af;
    }

    input:focus,
    select:focus,
    textarea:focus {
      border-color: var(--green);
      background: #ffffff;
      box-shadow: 0 0 0 1px rgba(34, 197, 94, 0.15);
    }

    textarea {
      resize: vertical;
      min-height: 60px;
    }

    .message {
      font-size: 12px;
      margin-top: 4px;
    }

    .message-ok {
      color: var(--green-dark);
    }

    .message-error {
      color: var(--red);
    }

    .list {
      margin: 6px 0 0;
      padding-left: 18px;
      font-size: 12px;
      color: var(--text-muted);
      max-height: 120px;
      overflow-y: auto;
    }

    /* PERFIL */
    .profile-row {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 10px;
    }

    .profile-avatar {
      width: 48px;
      height: 48px;
      border-radius: 999px;
      background: #dcfce7;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 22px;
      color: var(--green-dark);
    }

    .profile-name {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 2px;
    }

    .profile-text {
      font-size: 13px;
      color: var(--text-muted);
    }

    /* MEN√ö INFERIOR */
    .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: rgba(255, 255, 255, 0.96);
      backdrop-filter: blur(12px);
      border-top: 1px solid rgba(226, 232, 240, 0.9);
      transform: translateY(100%);
      opacity: 0;
      pointer-events: none;
      transition: transform 0.28s ease-out, opacity 0.28s ease-out;
    }

    .bottom-nav.bottom-nav-visible {
      transform: translateY(0);
      opacity: 1;
      pointer-events: auto;
    }

    .bottom-nav-inner {
      max-width: 480px;
      margin: 0 auto;
      display: flex;
      justify-content: space-around;
      padding: 6px 10px;
    }

    .nav-btn {
      flex: 1;
      border: none;
      background: transparent;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 2px;
      padding: 4px;
      border-radius: 999px;
      font-size: 12px;
      color: var(--text-muted);
      cursor: pointer;
    }

    .nav-icon {
      font-size: 20px;
    }

    .nav-btn-active {
      color: var(--teal);
      font-weight: 600;
      background: #e0f2f1;
    }
  </style>
</head>
<body>
  <!-- SPLASH -->
  <div id="splash" class="splash">
    <div class="splash-title">RECYBOOM</div>
    <div class="splash-sub">Reciclar f√°cil, en todo Chile</div>
    <div class="splash-icon">‚ôªÔ∏è</div>
    <div class="splash-hint">Toca la pantalla para entrar</div>
  </div>

  <div class="app">
    <!-- ENCABEZADO -->
    <header class="header">
      <div class="header-left">
        <div class="logo-circle">RB</div>
        <div>
          <h1 class="header-title">RECYBOOM</h1>
          <p class="header-sub">Reciclaje simple en Chile</p>
        </div>
      </div>
      <div class="header-badge">Piloto ¬∑ Chile</div>
    </header>

    <!-- CONTENIDO -->
    <main class="main">
      <div class="content">
        <!-- VISTA HOME (pantalla con mapa circular) -->
        <section id="view-home" class="view view-active home-view">
          <div class="home-hero">
            <div class="home-title">RECYBOOM</div>
            <p class="home-subtitle">Encuentra puntos de reciclaje y agenda retiros en todo Chile.</p>
            <div class="home-logo">‚ôªÔ∏è</div>
            <div id="map-circle" class="home-map-circle"></div>
            <p class="home-cta">Haz BOOM para reciclar</p>
            <p class="home-hint">Toca el mapa circular para ver el mapa completo y las opciones de la app.</p>

            <div class="home-quick-grid">
              <div class="home-quick-card" id="quick-map">
                <div class="home-quick-icon">üó∫Ô∏è</div>
                <div class="home-quick-title">Ver Mapa</div>
                <div style="font-size:11px;color:#6b7280;">Puntos de reciclaje</div>
              </div>
              <div class="home-quick-card" id="quick-retire">
                <div class="home-quick-icon">üöö</div>
                <div class="home-quick-title">Agendar Retiro</div>
                <div style="font-size:11px;color:#6b7280;">Simulaci√≥n a domicilio</div>
              </div>
            </div>
          </div>
        </section>

        <!-- VISTA MAPA -->
        <section id="view-map" class="view">
          <div class="card">
            <h2 class="card-title">Mapa de puntos en Chile</h2>
            <p class="card-text">
              Mira tu ubicaci√≥n y puntos de reciclaje de ejemplo en Chile. Tambi√©n puedes proponer un nuevo lugar cerca de ti.
            </p>

            <button class="btn-main" id="btn-locate-top">
              üìç Ver mi ubicaci√≥n
            </button>

            <div id="map"></div>

            <div class="status" id="location-status">
              <div id="location-dot" class="status-dot"></div>
              <span>Ubicaci√≥n lista para detectar.</span>
            </div>

            <p class="map-info">
              Toca en el mapa para sugerir un nuevo lugar donde reciclar.
            </p>

            <!-- FILTRO POR MATERIAL -->
            <div class="form-group">
              <label class="form-label" for="filter-material">Filtrar puntos por material</label>
              <select id="filter-material">
                <option value="todos">Todos los materiales</option>
                <option value="carton">Solo cart√≥n</option>
                <option value="vidrio">Solo vidrio</option>
                <option value="latas">Solo latas</option>
                <option value="plastico">Solo pl√°stico</option>
                <option value="mixto">Mixto (envases varios)</option>
                <option value="papel">Papel / documentos</option>
                <option value="pilas">Pilas</option>
                <option value="electro">Electr√≥nicos</option>
              </select>
            </div>

            <p id="coordinates-label" class="map-info">
              A√∫n no has tocado el mapa.
            </p>

            <div class="form-group">
              <label class="form-label" for="stop-name">Nombre del lugar</label>
              <input
                type="text"
                id="stop-name"
                placeholder="Ej: Punto limpio Plaza Central"
              />
            </div>

            <div class="form-group">
              <label class="form-label" for="stop-type">Tipo de lugar</label>
              <select id="stop-type">
                <option value="">Selecciona una opci√≥n</option>
                <option value="p√∫blico">P√∫blico (municipal)</option>
                <option value="vecinal">Vecinal</option>
                <option value="comercio">Comercio</option>
                <option value="colegio">Colegio / universidad</option>
              </select>
            </div>

            <div class="form-group">
              <label class="form-label" for="stop-materials">¬øQu√© se puede reciclar?</label>
              <textarea
                id="stop-materials"
                placeholder="Ej: Solo cart√≥n, solo vidrio, latas..."
              ></textarea>
            </div>

            <button class="btn-small" id="btn-new-stop">
              üìç Guardar sugerencia (demo)
            </button>
            <div id="new-stop-message" class="message"></div>

            <h3 style="font-size:14px; margin:10px 0 4px;">Puntos de ejemplo en Chile</h3>
            <ul id="example-list" class="list"></ul>

            <h3 style="font-size:14px; margin:10px 0 4px;">Tus sugerencias (solo hoy)</h3>
            <ul id="suggested-list" class="list"></ul>
          </div>
        </section>

        <!-- VISTA RETIRO -->
        <section id="view-retire" class="view">
          <div class="card">
            <h2 class="card-title">Agendar retiro (demo)</h2>
            <p class="card-text">
              Simula un retiro de reciclaje a domicilio. En una versi√≥n real, esta solicitud se enviar√≠a a un gestor de reciclaje local.
            </p>

            <div class="form-group">
              <label class="form-label" for="pickup-address">Direcci√≥n de retiro</label>
              <input
                type="text"
                id="pickup-address"
                placeholder="Ej: Av. Siempre Viva 123, Santiago"
              />
            </div>

            <div class="form-group">
              <label class="form-label" for="pickup-date">D√≠a y hora preferida</label>
              <input type="datetime-local" id="pickup-date" />
            </div>

            <div class="form-group">
              <label class="form-label" for="pickup-type">Material principal de retiro</label>
              <select id="pickup-type">
                <option value="">Selecciona una opci√≥n</option>
                <option value="mixto">Mezcla de envases</option>
                <option value="plastico">Pl√°sticos</option>
                <option value="vidrio">Vidrio</option>
                <option value="papel">Papel / cart√≥n</option>
                <option value="electro">Electr√≥nicos</option>
                <option value="pilas">Pilas</option>
              </select>
            </div>

            <div class="form-group">
              <label class="form-label" for="pickup-notes">Comentario (opcional)</label>
              <input
                type="text"
                id="pickup-notes"
                placeholder="Ej: Casa blanca, port√≥n caf√©..."
              />
            </div>

            <button class="btn-small" id="btn-pickup">
              ‚úÖ Confirmar retiro (demo)
            </button>
            <div id="pickup-message" class="message"></div>
          </div>
        </section>

        <!-- VISTA PERFIL -->
        <section id="view-profile" class="view">
          <div class="card">
            <h2 class="card-title">Mi perfil</h2>
            <div class="profile-row">
              <div class="profile-avatar">üôÇ</div>
              <div>
                <div class="profile-name">Invitado RECYBOOM</div>
                <div class="profile-text">Cuenta de demostraci√≥n</div>
              </div>
            </div>
            <p class="card-text">
              En una versi√≥n completa de la app podr√≠as ver:
            </p>
            <ul class="list">
              <li>Cu√°ntas veces has reciclado.</li>
              <li>Qu√© materiales reciclas m√°s.</li>
              <li>Tu impacto ambiental estimado en Chile.</li>
            </ul>
          </div>

          <div class="card">
            <h2 class="card-title">Sobre la app</h2>
            <p class="card-text">
              RECYBOOM quiere hacer el reciclaje algo muy simple:
            </p>
            <ul class="list">
              <li>Ver lugares cercanos para reciclar en Chile.</li>
              <li>Proponer nuevos puntos de reciclaje.</li>
              <li>Simular retiros a domicilio.</li>
            </ul>
          </div>
        </section>
      </div>
    </main>

    <!-- MEN√ö ABAJO -->
    <nav class="bottom-nav">
      <div class="bottom-nav-inner">
        <button class="nav-btn nav-btn-active" data-view="map">
          <span class="nav-icon">üó∫Ô∏è</span>
          <span>Mapa</span>
        </button>
        <button class="nav-btn" data-view="retire">
          <span class="nav-icon">üöö</span>
          <span>Retiro</span>
        </button>
        <button class="nav-btn" data-view="profile">
          <span class="nav-icon">üë§</span>
          <span>Perfil</span>
        </button>
      </div>
    </nav>
  </div>

  <!-- Leaflet JS -->
  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin=""
  ></script>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      /* --------- SPLASH --------- */
      const splash = document.getElementById("splash");
      const bottomNav = document.querySelector(".bottom-nav");

      splash.addEventListener("click", () => {
        splash.style.opacity = "0";
        setTimeout(() => {
          splash.style.display = "none";
          if (map) {
            map.invalidateSize();
          }
          if (miniMap) {
            miniMap.invalidateSize();
          }
        }, 250);
      });

      /* --------- NAVEGACI√ìN SIMPLE --------- */
      const views = {
        home: document.getElementById("view-home"),
        map: document.getElementById("view-map"),
        retire: document.getElementById("view-retire"),
        profile: document.getElementById("view-profile"),
      };
      const navButtons = document.querySelectorAll(".nav-btn");

      function showView(name) {
        Object.values(views).forEach((v) => v.classList.remove("view-active"));
        if (views[name]) {
          views[name].classList.add("view-active");
        }

        navButtons.forEach((btn) => {
          if (btn.dataset.view === name) {
            btn.classList.add("nav-btn-active");
          } else {
            btn.classList.remove("nav-btn-active");
          }
        });

        if (name === "map" && map) {
          setTimeout(() => map.invalidateSize(), 200);
        }
      }

      navButtons.forEach((btn) => {
        btn.addEventListener("click", () => {
          bottomNav.classList.add("bottom-nav-visible");
          showView(btn.dataset.view);
        });
      });

      function enterFromHome() {
        bottomNav.classList.add("bottom-nav-visible");
        showView("map");
      }

      /* --------- MAPA B√ÅSICO --------- */
      const locationStatus = document.getElementById("location-status");
      const locationDot = document.getElementById("location-dot");
      const coordinatesLabel = document.getElementById("coordinates-label");
      const exampleList = document.getElementById("example-list");
      const suggestedList = document.getElementById("suggested-list");
      const filterMaterial = document.getElementById("filter-material");

      const btnLocateTop = document.getElementById("btn-locate-top");
      const btnNewStop = document.getElementById("btn-new-stop");
      const newStopMessage = document.getElementById("new-stop-message");

      const mapCircleEl = document.getElementById("map-circle");
      const quickMap = document.getElementById("quick-map");
      const quickRetire = document.getElementById("quick-retire");

      let map;
      let miniMap;
      let userMarker = null;
      let newStopMarker = null;
      let newStopLatLng = null;
      let exampleMarkers = [];

      // PUNTOS DE EJEMPLO EN CHILE (varias ciudades)
      const examplePlaces = [
        {
          name: "Punto Limpio Plaza de Armas",
          info: "Mixto: pl√°stico, vidrio y cart√≥n",
          material: "mixto",
          city: "Santiago",
          lat: -33.4372,
          lng: -70.6506,
        },
        {
          name: "Centro Reciclaje Costanera",
          info: "Solo pl√°stico (botellas PET)",
          material: "plastico",
          city: "Valdivia",
          lat: -39.8156,
          lng: -73.2459,
        },
        {
          name: "Punto Vidrio Torre Mall",
          info: "Solo vidrio (botellas y frascos)",
          material: "vidrio",
          city: "Concepci√≥n",
          lat: -36.8269,
          lng: -73.0498,
        },
        {
          name: "Eco Punto Latas Centro",
          info: "Solo latas de bebidas y conservas",
          material: "latas",
          city: "Antofagasta",
          lat: -23.6509,
          lng: -70.3975,
        },
        {
          name: "Papel y Cart√≥n Universidad",
          info: "Papel y documentos",
          material: "papel",
          city: "Valpara√≠so",
          lat: -33.0472,
          lng: -71.6127,
        },
        {
          name: "Reciclaje Electr√≥nicos Norte",
          info: "Solo electr√≥nicos (computadores, celulares)",
          material: "electro",
          city: "Iquique",
          lat: -20.2307,
          lng: -70.1357,
        },
        {
          name: "Contenedor Pilas Municipalidad",
          info: "Pilas y bater√≠as peque√±as",
          material: "pilas",
          city: "Temuco",
          lat: -38.7359,
          lng: -72.5904,
        },
        {
          name: "Punto Cart√≥n Feria Vecinal",
          info: "Solo cart√≥n",
          material: "carton",
          city: "Puerto Montt",
          lat: -41.4689,
          lng: -72.9411,
        },
      ];

      // Inicializar mapa principal centrado en Chile
      map = L.map("map", {
        center: [-35.6751, -71.5429], // centro aproximado de Chile
        zoom: 5,
      });

      L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
        maxZoom: 19,
        attribution: "&copy; OpenStreetMap contributors",
      }).addTo(map);

      // Mapa circular de bienvenida (mini mapa)
      if (mapCircleEl) {
        miniMap = L.map("map-circle", {
          center: [-35.6751, -71.5429],
          zoom: 4,
          zoomControl: false,
          attributionControl: false,
        });

        L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
          maxZoom: 19,
        }).addTo(miniMap);

        miniMap.dragging.disable();
        miniMap.scrollWheelZoom.disable();
        miniMap.doubleClickZoom.disable();
        miniMap.boxZoom.disable();
        miniMap.keyboard.disable();
        if (miniMap.tap) {
          miniMap.tap.disable();
        }

        L.circleMarker([-35.6751, -71.5429], {
          radius: 8,
          color: "#22c55e",
          fillColor: "#22c55e",
          fillOpacity: 0.9,
        }).addTo(miniMap);

        mapCircleEl.addEventListener("click", enterFromHome);
      }

      if (quickMap) {
        quickMap.addEventListener("click", enterFromHome);
      }

      if (quickRetire) {
        quickRetire.addEventListener("click", () => {
          bottomNav.classList.add("bottom-nav-visible");
          showView("retire");
        });
      }

      // Mostrar lugares de ejemplo con marcadores
      examplePlaces.forEach((p) => {
        const marker = L.circleMarker([p.lat, p.lng], {
          radius: 7,
          color: "#22c55e",
          fillColor: "#22c55e",
          fillOpacity: 0.9,
        })
          .addTo(map)
          .bindPopup(
            "<strong>" +
              p.name +
              "</strong><br><small>" +
              p.info +
              "</small><br><small>Material: " +
              p.material +
              "</small><br><small>Ciudad: " +
              p.city +
              "</small>"
          );

        exampleMarkers.push({ place: p, marker: marker });
      });

      // Rellenar lista de ejemplo seg√∫n filtro
      function renderExampleList() {
        const filter = filterMaterial.value;
        exampleList.innerHTML = "";

        exampleMarkers.forEach(({ place, marker }) => {
          const matches = filter === "todos" || place.material === filter;

          if (matches) {
            if (!map.hasLayer(marker)) marker.addTo(map);
          } else {
            if (map.hasLayer(marker)) map.removeLayer(marker);
          }

          if (matches) {
            const li = document.createElement("li");
            li.textContent =
              place.name + " ‚Äì " + place.info + " (" + place.city + ")";
            exampleList.appendChild(li);
          }
        });

        if (!exampleList.children.length) {
          const li = document.createElement("li");
          li.textContent =
            "No hay puntos para este tipo de material en esta demo.";
          exampleList.appendChild(li);
        }
      }

      renderExampleList();

      filterMaterial.addEventListener("change", () => {
        renderExampleList();
      });

      function updateLocationStatus(message, error) {
        locationStatus.querySelector("span").textContent = message;
        if (error) {
          locationDot.classList.add("error");
        } else {
          locationDot.classList.remove("error");
        }
      }

      function locateUser() {
        if (!navigator.geolocation) {
          updateLocationStatus("Tu dispositivo no tiene geolocalizaci√≥n.", true);
          return;
        }

        updateLocationStatus("Buscando tu ubicaci√≥n...", false);

        navigator.geolocation.getCurrentPosition(
          (pos) => {
            const lat = pos.coords.latitude;
            const lng = pos.coords.longitude;

            if (userMarker) map.removeLayer(userMarker);

            userMarker = L.circleMarker([lat, lng], {
              radius: 8,
              color: "#0ea5e9",
              fillColor: "#0ea5e9",
              fillOpacity: 0.9,
            })
              .addTo(map)
              .bindPopup("Est√°s aqu√≠");

            map.setView([lat, lng], 13);
            updateLocationStatus("Ubicaci√≥n detectada.", false);
          },
          () => {
            updateLocationStatus("No se pudo obtener la ubicaci√≥n.", true);
          }
        );
      }

      btnLocateTop.addEventListener("click", () => {
        enterFromHome();
        locateUser();
      });

      // Tocar mapa para nuevo punto
      map.on("click", (e) => {
        newStopLatLng = e.latlng;

        if (newStopMarker) map.removeLayer(newStopMarker);

        newStopMarker = L.circleMarker(newStopLatLng, {
          radius: 7,
          color: "#eab308",
          fillColor: "#eab308",
          fillOpacity: 0.9,
        })
          .addTo(map)
          .bindPopup("Nuevo punto sugerido aqu√≠")
          .openPopup();

        coordinatesLabel.textContent =
          "Punto elegido: " +
          newStopLatLng.lat.toFixed(5) +
          ", " +
          newStopLatLng.lng.toFixed(5);
      });

      // Guardar sugerencia (solo en la lista)
      btnNewStop.addEventListener("click", () => {
        const name = document.getElementById("stop-name").value.trim();
        const type = document.getElementById("stop-type").value;
        const materials = document
          .getElementById("stop-materials")
          .value.trim();

        if (!newStopLatLng) {
          newStopMessage.textContent =
            "Primero toca el mapa para elegir un lugar.";
          newStopMessage.className = "message message-error";
          return;
        }

        if (!name || !type) {
          newStopMessage.textContent =
            "Escribe el nombre del lugar y el tipo.";
          newStopMessage.className = "message message-error";
          return;
        }

        const li = document.createElement("li");
        li.textContent =
          name +
          " (" +
          type +
          ") ‚Äì " +
          newStopLatLng.lat.toFixed(4) +
          ", " +
          newStopLatLng.lng.toFixed(4);
        if (materials) {
          li.textContent += " ¬∑ " + materials;
        }
        suggestedList.appendChild(li);

        newStopMessage.textContent =
          "Sugerencia guardada (solo en esta demo).";
        newStopMessage.className = "message message-ok";

        document.getElementById("stop-name").value = "";
        document.getElementById("stop-type").value = "";
        document.getElementById("stop-materials").value = "";
      });

      /* --------- RETIRO DEMO --------- */
      const btnPickup = document.getElementById("btn-pickup");
      const pickupMessage = document.getElementById("pickup-message");

      btnPickup.addEventListener("click", () => {
        const address = document
          .getElementById("pickup-address")
          .value.trim();
        const date = document.getElementById("pickup-date").value;
        const type = document.getElementById("pickup-type").value;

        if (!address || !date || !type) {
          pickupMessage.textContent =
            "Por favor completa direcci√≥n, d√≠a/hora y tipo de reciclaje.";
          pickupMessage.className = "message message-error";
          return;
        }

        pickupMessage.textContent =
          "Retiro guardado (demo). En una app real, esta solicitud se enviar√≠a al sistema de reciclaje.";
        pickupMessage.className = "message message-ok";
      });
    });
  </script>
</body>
</html>
